key.statistics[39]
View(key.statistics)
stock_health  <- paste("https://investorplace.com/stock-quotes/", stck, "-stock-quote/") %>%
read_html() %>%
html_nodes(xpath='//*[@class="stock-aside"]') %>%
html_nodes(xpath='//*[@class="grade grade-color"]') %>%
html_nodes(xpath='//*[@class="grade-color stock-grade-rating"]') %>%
html_text()
stock_health
# 6. Got Growth?
# Best case is when year-over-year (YoY) growth is accelerating.
df[18]
# 6. Got Growth?
# Best case is when year-over-year (YoY) growth is accelerating.
key.statistics[46]
# 7.Institutional Ownership
# O.K. to buy if percent held by institutions is at least 30% of shares outstanding.
df[22]
# 7.Institutional Ownership
# O.K. to buy if percent held by institutions is at least 30% of shares outstanding.
key.statistics[22]
# Extract and transform data
df.mw <- paste0("https://www.marketwatch.com/investing/Stock/", stck, "/analystestimates") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols) %>%
# Transpose
t() %>%
as_tibble()
df.mw <- df.mw[1:2,1:5]
# Set first row as column names
colnames(df.mw) <- df.mw[1,]
# Remove first row
df.mw <- df.mw[-1,]
# Add stock name column
df.mw$Stock_Name <- stock
df.mw[2]
df.mw[1]
incstat.qtr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/income/quarter") %>%
read_html() %>%
html_table() %>%
map_incstat(bind_cols)
#Subsetting the table into 2 tables
incstat.qtr10 <-   incstat.qtr[is.na(incstat.qtr[,1]),]
incstat.qtr20 <-   incstat.qtr[!is.na(incstat.qtr[,1]),1:6]
#table 2, rea rranging columns
incstat.qtr11 <- cbind(incstat.qtr10[8],incstat.qtr10[2:6])
# renaming 1st column
names(incstat.qtr20)[1] <- "account_name"
names(incstat.qtr11)[1] <- "account_name"
## appending the 2 tables from section row 146
incstat.qtr <- rbind(incstat.qtr20,incstat.qtr11)
# Select account name "Gross Income Growth"
incstat.gig <- incstat.qtr[grep("Gross Income Growth", incstat.qtr[,1]),]
library(quantmod)
library(tidyquant)
library(rvest)
library(xml2)
library(glue)
incstat.qtr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/income/quarter") %>%
read_html() %>%
html_table() %>%
map_incstat(bind_cols)
#Subsetting the table into 2 tables
incstat.qtr10 <-   incstat.qtr[is.na(incstat.qtr[,1]),]
incstat.qtr20 <-   incstat.qtr[!is.na(incstat.qtr[,1]),1:6]
#table 2, rea rranging columns
incstat.qtr11 <- cbind(incstat.qtr10[8],incstat.qtr10[2:6])
# renaming 1st column
names(incstat.qtr20)[1] <- "account_name"
names(incstat.qtr11)[1] <- "account_name"
## appending the 2 tables from section row 146
incstat.qtr <- rbind(incstat.qtr20,incstat.qtr11)
# Select account name "Gross Income Growth"
incstat.gig <- incstat.qtr[grep("Gross Income Growth", incstat.qtr[,1]),]
# Quarterly Income Statement
incstat.qtr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/income/quarter") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
incstat.qtr10 <-   incstat.qtr[is.na(incstat.qtr[,1]),]
incstat.qtr20 <-   incstat.qtr[!is.na(incstat.qtr[,1]),1:6]
#table 2, rea rranging columns
incstat.qtr11 <- cbind(incstat.qtr10[8],incstat.qtr10[2:6])
# renaming 1st column
names(incstat.qtr20)[1] <- "account_name"
names(incstat.qtr11)[1] <- "account_name"
## appending the 2 tables from section row 146
incstat.qtr <- rbind(incstat.qtr20,incstat.qtr11)
# Select account name "Gross Income Growth"
incstat.gig <- incstat.qtr[grep("Gross Income Growth", incstat.qtr[,1]),]
incstat.gig
# Yearly income statement
incstat.yr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
incstat.yr10 <-   incstat.yr[is.na(incstat.yr[,1]),]
incstat.yr20 <-   incstat.yr[!is.na(incstat.yr[,1]),1:6]
#table 1, rearranging columns
incstat.yr11 <- cbind(incstat.yr10[8],incstat.yr10[2:6])
# renaming 1st column
names(incstat.yr20)[1] <- "account_name"
names(incstat.yr11)[1] <- "account_name"
# appending the 2 tables from above section
incstat.yr <- rbind(incstat.yr20,incstat.yr11)
str(incstat.yr)
# Quarterly sales growth
incstat.revg <- incstat.qtr[grep("Sales Growth", incstat.qtr[,1]),]
# Yearly sales growth
incstat.yr.revg <- incstat.yr[grep("Sales Growth", incstat.yr[,1]),]
key.analysis <- paste0("https://finance.yahoo.com/quote/", stck, "/analysis?p=", stck) %>%
read_html() %>%
html_table()
key.analysis
View(key.analysis)
# Revenue Estimate table
rev.est <- data.table(key.analysis[2])
library(quantmod)
library(tidyquant)
library(rvest)
library(xml2)
library(glue)
# Revenue Estimate table
rev.est <- data.table(key.analysis[2])
# Revenue Estimate data frame
rev.est <- data.frame(key.analysis[2])
# revenue estimate growth
rev.est.grw <- rev.est[grep("Growth", rev.est[,1]),]
rev.est.grw
View(rev.est)
bs.yr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/balance-sheet") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
bs.yr10 <-   bs.yr[is.na(bs.yr[,1]),]
bs.yr20 <-   bs.yr[!is.na(bs.yr[,1]),1:6]
#table 1, rearranging columns
bs.yr11 <- cbind(bs.yr10[8],bs.yr10[2:6])
# renaming 1st column on both tables
names(bs.yr20)[1] <- "account_name"
names(bs.yr11)[1] <- "account_name"
## appending the 2 tables from section row 146
bs.yr <- rbind(bs.yr20,bs.yr11)
# Select account name "accounts receivable"
bs.ar <- bs.yr[grep("Total Accounts Receivable", bs.yr[,1]),]
# Balance Sheet quarterly
bs.qr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/balance-sheet") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
bs.qr10 <-   bs.qr[is.na(bs.qr[,1]),]
bs.qr20 <-   bs.qr[!is.na(bs.qr[,1]),1:6]
#table 1, rearranging columns
bs.qr11 <- cbind(bs.qr10[8],bs.qr10[2:6])
# renaming 1st column on both tables
names(bs.qr20)[1] <- "account_name"
names(bs.qr11)[1] <- "account_name"
## appending the 2 tables from section row 146
bs.qr <- rbind(bs.qr20,bs.qr11)
# Select account name "accounts receivable"
bs.ar <- bs.qr[grep("Total Accounts Receivable", bs.qr[,1]),]
# select revenue from Inc Statement yearly
rev.qr <- incstat.yr[grep("Revenue", incstat.qr[,1]),]
# select revenue from Inc Statement yearly
rev.qr <- incstat.qtr[grep("Revenue", incstat.qtr[,1]),]
# select revenue from Inc Statement yearly
rev.qtr <- incstat.qtr[grep("Revenue", incstat.qtr[,1]),]
rev.qtr
incstat.qtr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/income/quarter") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
incstat.qtr10 <-   incstat.qtr[is.na(incstat.qtr[,1]),]
incstat.qtr20 <-   incstat.qtr[!is.na(incstat.qtr[,1]),1:6]
#table 1, rearranging columns
incstat.qtr11 <- cbind(incstat.qtr10[8],incstat.qtr10[2:6])
# renaming 1st column
names(incstat.qtr20)[1] <- "account_name"
names(incstat.qtr11)[1] <- "account_name"
# appending the 2 tables from above section
incstat.qtr <- rbind(incstat.qtr20,incstat.qtr11)
# Select account name "Gross Income Growth"
incstat.gig <- incstat.qtr[grep("Gross Income Growth", incstat.qtr[,1]),]
# 2.Revenue (sales) Growth Rate Latest Quarter compared
# to previous quarter & most recent year.
# Compare the most recent quarter's (MRQ) year-overyear sales growth rate to previous
# quarters and to the most recent year.
# Ideally, revenue growth would be accelerating or at least equal to earlier numbers.
# But, it's O.K. to buy if MRQ growth is at least 75% of recent growth numbers
# Yearly income statement
incstat.yr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
incstat.yr10 <-   incstat.yr[is.na(incstat.yr[,1]),]
incstat.yr20 <-   incstat.yr[!is.na(incstat.yr[,1]),1:6]
#table 1, rearranging columns
incstat.yr11 <- cbind(incstat.yr10[8],incstat.yr10[2:6])
# renaming 1st column
names(incstat.yr20)[1] <- "account_name"
names(incstat.yr11)[1] <- "account_name"
# appending the 2 tables from above section
incstat.yr <- rbind(incstat.yr20,incstat.yr11)
str(incstat.yr)
# Quarterly sales growth
incstat.revg <- incstat.qtr[grep("Sales Growth", incstat.qtr[,1]),]
# Yearly sales growth
incstat.yr.revg <- incstat.yr[grep("Sales Growth", incstat.yr[,1]),]
#3. Forecast Revenue Growth Rate
# Compare consensus revenue growth forecasts to historical numbers.
key.analysis <- paste0("https://finance.yahoo.com/quote/", stck, "/analysis?p=", stck) %>%
read_html() %>%
html_table()
key.analysis
View(key.analysis)
# Revenue Estimate data frame
rev.est <- data.frame(key.analysis[2])
# revenue estimate growth
rev.est.grw <- rev.est[grep("Growth", rev.est[,1]),]
#4. Accounts receivables growth vs sales growth
# Accounts Receivables Ratio (ratio) is the total receivables
# divided by the revenue for the same quarter
# ratio for the most recent and the year-ago quarters
# Ideally the most recent ratio would be less than yearago, but it's O.K. to
# buy if the ratio is the same or lower than year-ago.
# Ignore increases that are less than 5%, e.g. from 60% to 64%
# Balance Sheet yearly
bs.yr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/balance-sheet") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
bs.yr10 <-   bs.yr[is.na(bs.yr[,1]),]
bs.yr20 <-   bs.yr[!is.na(bs.yr[,1]),1:6]
#table 1, rearranging columns
bs.yr11 <- cbind(bs.yr10[8],bs.yr10[2:6])
# renaming 1st column on both tables
names(bs.yr20)[1] <- "account_name"
names(bs.yr11)[1] <- "account_name"
## appending the 2 tables from section row 146
bs.yr <- rbind(bs.yr20,bs.yr11)
# Select account name "accounts receivable"
bs.ar <- bs.yr[grep("Total Accounts Receivable", bs.yr[,1]),]
# select revenue from Inc Statement yearly
rev.yr <- incstat.yr[grep("Revenue", incstat.yr[,1]),]
# Balance Sheet quarterly
bs.qtr <- paste0("https://www.marketwatch.com/investing/Stock/", "FNV", "/financials/balance-sheet") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols)
#Subsetting the table into 2 tables
bs.qtr10 <-   bs.qtr[is.na(bs.qtr[,1]),]
bs.qtr20 <-   bs.qtr[!is.na(bs.qtr[,1]),1:6]
#table 1, rearranging columns
bs.qr11 <- cbind(bs.qr10[8],bs.qr10[2:6])
# renaming 1st column on both tables
names(bs.qtr20)[1] <- "account_name"
names(bs.qtr11)[1] <- "account_name"
## appending the 2 tables from section row 146
bs.qtr <- rbind(bs.qtr20,bs.qtr11)
# Select account name "accounts receivable"
bs.ar <- bs.qtr[grep("Total Accounts Receivable", bs.qtr[,1]),]
# select revenue from Inc Statement yearly
rev.qtr <- incstat.qtr[grep("Revenue", incstat.qtr[,1]),]
#table 1, rearranging columns
bs.qtr11 <- cbind(bs.qtr10[8],bs.qtr10[2:6])
names(bs.qtr11)[1] <- "account_name"
# Select account name "accounts receivable"
bs.ar <- bs.qtr[grep("Total Accounts Receivable", bs.qtr[,1]),]
# select revenue from Inc Statement yearly
rev.qtr <- incstat.qtr[grep("Revenue", incstat.qtr[,1]),]
View(bs.qtr)
rev.qtr
as.numeric(gsub("\\M", "", rev.qtr$`30-Jun-2018`))
library(quantmod)
library(tidyquant)
library(rvest)
library(xml2)
library(glue)
# tidyquant: https://cran.r-project.org/web/packages/tidyquant/vignettes/TQ01-core-functions-in-tidyquant.html
## Part 1: Basic Research ##
# 1. One-year Price chart with 50-day moving average
# List all available metrics from Yahoo finance
# O.K. to buy if stock price is above its 50-day moving average.
company <- c("FNV")
# use getsymbols() to convert a char
stck <- getSymbols(company)
# charting
stockEnv <- new.env()
symbols <- getSymbols(stck, src='yahoo', env=stockEnv)
# O.K. to buy if stock price is above its 50-day moving average.
for (stock in ls(stockEnv)){
chartSeries(stockEnv[[stock]], theme="white", name=stock,
TA="addVo(); addSMA(50, col='black')", subset='last 365 days')
}
# 2. Price/Sales ratio (P/S)
# O.K. to buy if P/S is less than 10.
# P/S ratios between 3 and 5 are best for growth stocks.
# Ratios below 2 reflect value priced stocks.
key.statistics <- paste0("https://finance.yahoo.com/quote/", stck, "/key-statistics?p=", stck) %>%
read_html() %>%
html_table() %>%
map_df(bind_cols) %>%
# Transpose
t() %>%
as_tibble()
# Set first row as column names
colnames(key.statistics) <- key.statistics[1,]
# Remove first row
key.statistics <- key.statistics[-1,]
# Add stock name column
key.statistics$Stock_Name <- stck
key.statistics[6]
# 3. Cash Flow
# O.K. to buy if Cash Flow is a positive number.
cash.flow <- glue("https://www.marketwatch.com/investing/Stock/",{company},"/profile/") %>%
read_html() %>%
html_nodes(xpath='//*[@class="sixwide addgutter"]') %>%
html_nodes(xpath='//*[@class="section"]') %>%
#   html_nodes(xpath='//*[@class="column"]') %>% .[[10]] %>%
#  html_text() %>%
html_nodes(xpath='//*[@class="data lastcolumn"]') %>% .[[8]]%>%
html_text()
cash.flow
# 4. Average Daily Volume (shares)
# O.K. to buy if Average Daily Volume is 150,000 shares or higher, and above one million shares is best.
key.statistics[17]
# 5. Fundamental Health Grade
# www.Investorplace.com
stock_health  <- paste("https://investorplace.com/stock-quotes/", stck, "-stock-quote/") %>%
read_html() %>%
html_nodes(xpath='//*[@class="stock-aside"]') %>%
html_nodes(xpath='//*[@class="grade grade-color"]') %>%
html_nodes(xpath='//*[@class="grade-color stock-grade-rating"]') %>%
html_text()
stock_health
# 6. Got Growth?
# Best case is when year-over-year (YoY) growth is accelerating.
key.statistics[46]
# 7.Institutional Ownership
# O.K. to buy if percent held by institutions is at least 30% of shares outstanding.
key.statistics[22]
# 8. Number of Analysts Making Buy/Hold/Sell Recs.
# O.K. to buy if a total of at least 4 analysts are listed
# as currently making strong buy, buy, hold, underperform, or sell recommendations.
# Look only at the total number of analysts making recommendations,
# not whether there are more buys than holds, etc.
# Extract and transform data
df.mw <- paste0("https://www.marketwatch.com/investing/Stock/", stck, "/analystestimates") %>%
read_html() %>%
html_table() %>%
map_df(bind_cols) %>%
# Transpose
t() %>%
as_tibble()
df.mw <- df.mw[1:2,1:5]
# Set first row as column names
colnames(df.mw) <- df.mw[1,]
# Remove first row
df.mw <- df.mw[-1,]
# Add stock name column
df.mw$Stock_Name <- stock
key.statistics <- paste0("https://finance.yahoo.com/quote/", stck, "/key-statistics?p=", stck) %>%
read_html() %>%
html_table() %>%
map_df(bind_cols) %>%
# Transpose
t() %>%
as_tibble(.name_repair = "universal")
View(key.statistics)
# Set first row as column names
colnames(key.statistics) <- key.statistics[1,]
# Remove first row
key.statistics <- key.statistics[-1,]
# Add stock name column
key.statistics$Stock_Name <- stck
key.statistics[6]
cbind(key.statistics,stock_health)
a <- cbind(key.statistics,stock_health)
View(a)
a <- cbind(key.statistics[60],key.statistics[6],cash.flow,
key.statistics[17], stock_health, key.statistics[46],
key.statistics[22],df.mw[2], df.mw[1])
View(a)
key.statistics <- paste0("https://finance.yahoo.com/quote/", stck, "/key-statistics?p=", stck) %>%
read_html() %>%
html_table() %>%
map_df(bind_cols) %>%
# Transpose
t() %>%
as_tibble()
View(key.statistics)
colnames(key.statistics) <- key.statistics[1,]
# Remove first row
key.statistics <- key.statistics[-1,]
# Add Stock Ticker as a column
key.statistics$Stock_Ticker <- stck
View(key.statistics)
a <- cbind(key.statistics[60],key.statistics[6],cash.flow,
key.statistics[17], stock_health, key.statistics[46],
key.statistics[22],df.mw[2], df.mw[1])
View(a)
a[1] <- 'Price/Sales ratio (P/S)'
a[2,] <- 'Price/Sales ratio (P/S)'
a[,2] <- 'Price/Sales ratio (P/S)'
a <- cbind(key.statistics[60],key.statistics[6],cash.flow,
key.statistics[17], stock_health, key.statistics[46],
key.statistics[22],df.mw[2], df.mw[1])
a[,2]
a[,1]
a[2,1]
a[1,1]
a[1,2]
a[2,2]
a[1,1]
a[,1]
a[1]
colnames(a)
colnames(a[2])
colnames(a[2]) <- 'Price/Sales ratio (P/S)'
View(a)
colnames(a[2])
a$`Price/Sales (ttm)` <- 'Price/Sales ratio (P/S)'
View(a)
names(a)
names(a)[2] <- 'Price/Sales ratio (P/S)'
a
View(a)
names(a) <- c('Price/Sales ratio (P/S)',
'Cash Flow',
'Average daily volume (shares)',
'Fundamental Health Grade',
'Got Growth?',
'Institutional Ownership',
'Number of Analysts making recommendations'
)
View(a)
names(a) <- c('Stock Ticker',
'Price/Sales ratio (P/S)',
'Cash Flow',
'Average daily volume (shares)',
'Fundamental Health Grade',
'Got Growth?',
'Institutional Ownership',
'Number of Analysts making recommendations'
)
View(df.mw)
## Create a table to publish on dashboard
abt <- cbind(key.statistics[60],key.statistics[6],cash.flow,
key.statistics[17], stock_health, key.statistics[46],
key.statistics[22],df.mw[2], df.mw[1])
names(abt) <- c('Stock Ticker',
'Price/Sales ratio (P/S)',
'Cash Flow',
'Average daily volume (shares)',
'Fundamental Health Grade',
'Got Growth?',
'Institutional Ownership',
'Number of Analysts making recommendations',
'Average recommendation'
)
View(abt)
row.why <- c('Valuation check. A stock with a P/S above 10 is momentum priced. Buying momentum priced stocks is only recommended in a strong market')
aa <- rbind(a,row.why)
aa
View(aa)
row.why <- c('Valuation check. A stock with a P/S above 10 is momentum priced. Buying momentum priced stocks is only recommended in a strong market'
,
'Price/Sales ratio (P/S)',
'Cash Flow',
'Average daily volume (shares)',
'Fundamental Health Grade',
'Got Growth?',
'Institutional Ownership',
'Number of Analysts making recommendations',
'Average recommendation'
)
aa <- rbind(a,row.why)
View(aa)
a <- cbind(key.statistics[60],key.statistics[6],cash.flow,
key.statistics[17], as.character(stock_health), key.statistics[46],
key.statistics[22],df.mw[2], df.mw[1])
as.character(stock_health)
str(as.character(stock_health))
str(stock_health)
stock_health <- as.data.frame(stock_health)
stock_health <- as.data.frame(as.character(stock_health))
stock_health
View(stock_health)
stock_health
stock_health  <- paste("https://investorplace.com/stock-quotes/", stck, "-stock-quote/") %>%
read_html() %>%
html_nodes(xpath='//*[@class="stock-aside"]') %>%
html_nodes(xpath='//*[@class="grade grade-color"]') %>%
html_nodes(xpath='//*[@class="grade-color stock-grade-rating"]') %>%
html_text()
stock.health <- as.data.frame(as.character(stock_health))
stock.health
View(stock.health)
as.character(stock_health)
stock_health
numbers <- factor(c(9, 8, 10, 8, 9))
str(numbers)
as.character(numbers)
str(as.character(numbers))
